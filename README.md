# sharepoint-butget
# สคริปต์อัปโหลดไฟล์และการจัดการสำหรับ SharePoint

## ภาพรวม
โค้ด C# นี้แสดงการทำงานในการอ่านข้อมูลจากไฟล์ CSV และอัปโหลดไฟล์ที่เกี่ยวข้องไปยังไซต์ SharePoint พร้อมกับตั้งค่าสิทธิ์และเมตาดาต้าสำหรับแต่ละไฟล์ ต่อไปนี้คือการอธิบายแต่ละส่วนของโค้ดให้เข้าใจง่ายสำหรับผู้ที่เริ่มต้น:

### 1. Set Up Connection (ตั้งค่าการเชื่อมต่อ)
โปรแกรมเริ่มต้นด้วยการสร้างการเชื่อมต่อไปยังไซต์ SharePoint โดยใช้ข้อมูลประจำตัวที่กำหนดไว้:
- `siteURL`, `username`, และ `password` ถูกใช้เพื่อสร้างออบเจกต์ `ClientContext` ซึ่งจำเป็นสำหรับการโต้ตอบกับ SharePoint.
- `password` ถูกแปลงเป็น `SecureString` เพื่อความปลอดภัยก่อนที่จะใช้งาน.

### 2. Read CSV and Upload Files (อ่าน CSV และอัปโหลดไฟล์)
ฟังก์ชันหลักจัดการในเมธอด `ReadCsvUpload` นี่คือขั้นตอนต่างๆ:

#### a. Open CSV File (เปิดไฟล์ CSV)
- ไฟล์ CSV ถูกอ่านทีละบรรทัด แต่ละบรรทัดมีรายละเอียดเช่นชื่อเอกสาร, ชื่อไฟล์, และบทบาทของผู้ใช้.

#### b. Process Each Line (ประมวลผลแต่ละบรรทัด)
สำหรับแต่ละบรรทัดใน CSV:
- มันแยกบรรทัดออกเป็นค่าต่างๆ (เช่น, ชื่อ, ชื่อไฟล์, ฯลฯ).
- สร้างเส้นทางไฟล์จากชื่อไฟล์และตรวจสอบว่าไฟล์นั้นมีอยู่หรือไม่.

#### c. Upload File to SharePoint (อัปโหลดไฟล์ไปยัง SharePoint)
ถ้าไฟล์นั้นมีอยู่:
- ไฟล์จะถูกเปิดและอัปโหลดไปยังไลบรารีที่ระบุ (`budgetLibraryName`) บน SharePoint.
- ตั้งค่าต่างๆ เช่น metadata อาทิ ชื่อ, กลุ่ม, แผนก, ฯลฯ จากค่าใน CSV.

#### d. Set Permissions (ตั้งค่าสิทธิ์)
- สิทธิ์ถูกปรับใช้งานโดยใช้ `RoleDefinitionBindingCollection` ผู้ใช้งานบางคน (จาก CSV) ได้รับการมอบหมายบทบาทที่ควบคุมสิ่งที่พวกเขาสามารถทำกับเอกสารได้.
- เช่น, `Budget_2024_edit` อาจเป็นระดับการอนุญาตที่อนุญาตให้ผู้ใช้บางคนแก้ไขเอกสาร.

#### e. Error Handling (การจัดการข้อผิดพลาด)
- ถ้าไฟล์ไม่มีอยู่หรือมีข้อผิดพลาดในระหว่างการประมวลผล มันจะบันทึกข้อมูลเพื่อการแก้ไขปัญหา.

### 3. Logging (การบันทึก)
- ความสำเร็จและข้อผิดพลาดถูกบันทึกไว้ในไฟล์ที่แตกต่างกัน ทำให้มีการบันทึกการอัปโหลดที่สำเร็จและการล้มเหลว.

### 4. Clean Up (การจัดการทำความสะอาด)
- หลังจากประมวลผลทุกบรรทัดแล้ว โปรแกรมจะบันทึกการสิ้นสุดของการดำเนินการ.

### Key Points to Understand (จุดสำคัญที่ต้องเข้าใจ)
- **File Handling (การจัดการไฟล์)**: โค้ดอ่านจากระบบไฟล์และจัดการไฟล์สตรีมเพื่ออัปโหลดไปยัง SharePoint.
- **SharePoint API**: มีการโต้ตอบกับ SharePoint's client-side object model (CSOM) อย่างกว้างขวางเพื่อจัดการเนื้อหาบนไซต์ SharePoint.
- **Security (ความปลอดภัย)**: จัดการข้อมูลประจำตัวอย่างปลอดภัยและยังแสดงการทำให้สืบทอดและตั้งค่าการสืบทอดสิทธิ์ใหม่สำหรับรายการสิทธิ์ ซึ่งมีความสำคัญสำหรับการรักษาการความคุมการเข้าถึงที่เหมาะสมในสภาพแวดล้อมทางธุรกิจ.
- **Error Logging (การบันทึกข้อผิดพลาด)**: สำคัญสำหรับการแก้ไขปัญหาและรับรองความถูกต้องของข้อมูลการดำเนินงาน.

สคริปต์นี้ได้รับการออกแบบมาเพื่ออัตโนมัติการอัปโหลดเอกสารที่เกี่ยวข้องกับงบประมาณไปยัง SharePoint, การตั้งค่าเมตาดาต้า, และการกำหนดสิทธิ์การเข้าถึงตามบทบาทที่ระบุในไฟล์ CSV, ซึ่งช่วยลดความผิดพลาดและความซับซ้อนในงานที่อาจต้องทำด้วยมือ.
